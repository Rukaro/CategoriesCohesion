# Vercel 部署故障排查

## 错误：Function Runtimes must have a valid version

### 解决方案 1: 使用当前简化配置（推荐）

当前的 `vercel.json` 已简化为：
```json
{
  "rewrites": [
    {
      "source": "/api/calculate-cohesion",
      "destination": "/api/calculate.py"
    },
    {
      "source": "/api/health",
      "destination": "/api/health.py"
    }
  ]
}
```

这个配置应该可以工作。

### 解决方案 2: 完全移除 vercel.json

如果方案 1 不行，可以完全移除 `vercel.json`：

```bash
# 删除 vercel.json
rm vercel.json
# 或重命名
mv vercel.json vercel.json.backup
```

然后 Vercel 会自动检测 `api/` 目录下的 Python 文件，路由为：
- `/api/calculate.py`
- `/api/health.py`

需要更新前端代码中的 API 地址。

### 解决方案 3: 使用 Vercel Dashboard 配置

1. 在 Vercel Dashboard 中进入项目设置
2. 在 Functions 标签页中配置超时时间
3. 不需要在 `vercel.json` 中配置

## 验证部署

部署后，测试以下端点：

1. **健康检查**：
   ```
   https://your-project.vercel.app/api/health
   ```

2. **计算 API**：
   ```
   https://your-project.vercel.app/api/calculate-cohesion
   ```

3. **前端页面**：
   ```
   https://your-project.vercel.app/
   ```

## 如果仍然失败

1. **检查 Vercel 构建日志**
   - 查看是否有 Python 依赖安装错误
   - 检查模型下载是否成功

2. **检查 API 文件格式**
   - 确保有 `handler` 函数
   - 确保返回格式正确

3. **尝试本地测试**
   ```bash
   vercel dev
   ```

4. **查看 Vercel 文档**
   - https://vercel.com/docs/functions/serverless-functions/runtimes/python

